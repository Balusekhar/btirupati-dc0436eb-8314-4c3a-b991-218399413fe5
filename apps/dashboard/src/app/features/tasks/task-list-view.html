@if (tasks.length === 0) {
  <div class="rounded-lg border border-gray-200 bg-white p-12 text-center">
    <div class="text-4xl mb-3">&#128203;</div>
    <h3 class="text-base font-semibold text-gray-700 mb-1">No tasks yet</h3>
    <p class="text-sm text-gray-400 mb-4 max-w-xs mx-auto">
      Get started by creating your first task, or adjust your filters.
    </p>
    <button
      class="rounded-md bg-brand px-4 py-2 text-sm text-white font-semibold transition hover:bg-brand-dark"
      type="button"
      (click)="requestCreate.emit()"
    >
      + Create your first task
    </button>
  </div>
} @else {
  <div class="d-flex flex-column gap-3">
    @for (task of tasks; track task.id) {
      <div class="rounded-lg border border-gray-200 bg-white p-4 hover:shadow-sm transition">
        <div class="d-flex flex-items-start flex-justify-between gap-3">
          <div class="flex-1">
            <div class="d-flex flex-items-center gap-2 flex-wrap">
              <h3 class="text-base font-semibold text-gray-800 m-0">{{ task.title }}</h3>
              <span class="inline-block rounded-full px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-600">
                {{ task.status }}
              </span>
              <span class="inline-block rounded-full px-2 py-0.5 text-xs font-medium"
                [class]="task.category === 'work' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'"
              >
                {{ task.category }}
              </span>
              @if (task.dueAt) {
                <span class="text-xs text-gray-400">Due {{ task.dueAt }}</span>
              }
            </div>

            @if (task.description) {
              <p class="mt-1.5 mb-0 text-sm text-gray-500 leading-relaxed">
                {{ truncate(task.description) }}
              </p>
            }
          </div>

          <div class="d-flex flex-items-center gap-1.5 flex-shrink-0">
            @if (editingTaskId() === task.id) {
              <button
                class="rounded-md border border-gray-200 bg-white px-2.5 py-1 text-xs text-gray-600 font-medium transition hover:bg-gray-50"
                type="button"
                (click)="cancelEdit()"
              >
                Cancel
              </button>
            } @else {
              <button
                class="rounded-md border border-gray-200 bg-white px-2.5 py-1 text-xs text-gray-600 font-medium transition hover:bg-gray-50"
                type="button"
                (click)="startEdit(task)"
              >
                Edit
              </button>
              <button
                class="rounded-md border border-red-200 bg-white px-2.5 py-1 text-xs text-red-600 font-medium transition hover:bg-red-50"
                type="button"
                (click)="removeTask.emit(task)"
              >
                Delete
              </button>
            }
          </div>
        </div>

        <!-- Edit form -->
        @if (editingTaskId() === task.id) {
          <div class="mt-3 pt-3 border-t border-gray-100">
            @if (editError()) {
              <div class="rounded-md border border-red-200 bg-red-50 px-3 py-2 mb-3 d-flex flex-items-center gap-2" role="alert">
                <svg class="text-red-500 flex-shrink-0" width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm9-3a1 1 0 10-2 0v4a1 1 0 002 0V5zm-.25 6.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"/>
                </svg>
                <p class="text-sm text-red-700 m-0">{{ editError() }}</p>
              </div>
            }

            <form class="d-flex flex-column gap-3" [formGroup]="editForm" (ngSubmit)="submitEdit(task)">
              <div class="d-flex flex-column flex-md-row gap-3">
                <div class="flex-1">
                  <label class="block text-xs font-medium text-gray-500 mb-1" for="editTitle-{{ task.id }}">Title</label>
                  <input
                    id="editTitle-{{ task.id }}"
                    class="form-control input-block"
                    type="text"
                    formControlName="title"
                  />
                </div>
                <div class="flex-1">
                  <label class="block text-xs font-medium text-gray-500 mb-1" for="editStatus-{{ task.id }}">Status</label>
                  <select
                    id="editStatus-{{ task.id }}"
                    class="form-select input-block"
                    formControlName="status"
                  >
                    @for (s of statusOptions; track s) {
                      <option [value]="s">{{ s }}</option>
                    }
                  </select>
                </div>
              </div>

              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1" for="editDesc-{{ task.id }}">Description</label>
                <textarea
                  id="editDesc-{{ task.id }}"
                  class="form-control input-block"
                  rows="2"
                  formControlName="description"
                ></textarea>
              </div>

              <div class="d-flex flex-column flex-md-row gap-3">
                <div class="flex-1">
                  <label class="block text-xs font-medium text-gray-500 mb-1" for="editDueAt-{{ task.id }}">Due at (optional)</label>
                  <input
                    id="editDueAt-{{ task.id }}"
                    class="form-control input-block"
                    type="datetime-local"
                    formControlName="dueAt"
                  />
                </div>
              </div>

              <div class="d-flex flex-items-center gap-2">
                <button
                  class="rounded-md bg-brand px-4 py-1.5 text-sm text-white font-semibold transition hover:bg-brand-dark disabled:opacity-50 d-flex flex-items-center gap-1"
                  type="submit"
                  [disabled]="isEditSubmitting()"
                >
                  @if (isEditSubmitting()) {
                    <app-spinner size="sm" />
                  }
                  Save changes
                </button>
                <button
                  class="rounded-md border border-gray-200 bg-white px-4 py-1.5 text-sm text-gray-600 font-medium transition hover:bg-gray-50"
                  type="button"
                  (click)="cancelEdit()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        }
      </div>
    }
  </div>
}
